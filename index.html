<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>typo-crusher</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      body{font-size:20px;text-align: center;}
      #pastespace{ margin-bottom: 2em;}
      #displayspace>p{margin:0;}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1>typo-crusher</h1>
          <h2>See your writing in an unfamiliar context</h2>
          <h3>Help proofread your writing and <a href="http://www.wired.com/2014/08/wuwt-typos/">spot typos that your brain hides</a>.</h3>
          <p>Try by pasting this example:</p>
          <blockquote> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed a nisl viverra, consectetur urna eu, malesuada diam. In hac habitasse platea dictumst. Proin ultrices sapien feugiat, rutrum odio cursus, sodales neque. Curabitur eu scelerisque sapien. Duis suscipit posuere lectus eu aliquet. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Morbi a accumsan nulla.</blockquote>
          <textarea class="form-control" rows="3" id="pastespace" placeholder="Paste text here..."></textarea>
          <div id="displayspace"></div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js"></script>
    <script>
    $( document ).ready(function() {
      $.get( "https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyD676tSVUxUHoceP8gGTnta5KH-jwVtUtQ", function( data ) {
        //console.log(data);
        var subset = _.sample(data.items, 15);
        //console.log(subset);
        names = _.pluck(subset, 'family');
        //console.log(names);
        WebFont.load({
          google: {
            families: names
          }
        });
      });
      var names = [];
      $('#pastespace').bind("propertychange keyup input paste", function(event){
        var text = $('#pastespace').val();
        //console.log(text);
        var sentences = text.match( /[^\.!\?]+[\.!\?]+/g );
        //console.log(sentences);
        $('#displayspace').text("");
        if(sentences){
          sentences.forEach(function(sentence){
            sentence.trim();
            $('#displayspace').append("<p style='font-family:\""+names[Math.floor(Math.random()*names.length)]+"\";'>"+sentence+"</p>");
          });
        }
        else{
          $('#displayspace').append("<p style='font-family:\""+names[Math.floor(Math.random()*names.length)]+"\";'>"+text+"</p>");
        }
      }).change();
    });
    </script>
  </body>
</html>
